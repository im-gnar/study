# 10장: 애플리케이션 프로그래밍과 시스템 프로그래밍

터미널은 I/O 장치이며, 사용자 프로그램은 직접 I/O 장치와 통신하지 않는다 (OS가 중간에서 통신을 중재)

#### 문맥 전환
- 한 프로그램을 다른 프로그램으로 변경할 때 프로세스 컨텍스트를 저장, 복구해야 한다.
  - CPU 레지스터, MMU 레지스터, I/O 상태 등
- 문맥 전환은 비용이 큼
- 시스템 콜을 사용해 터미널에서 입력을 읽고 싶다는 의사 표시
  - 그 결과로 사용자 프로그램은 슬립 상태가 되고 다른 동작을 수행할 수 있음
  - 장치드라이버는 터미널에 들어오는 문자를 장치 드라이버는 입력 버퍼에 키 입력을 저장하고, 입력이 완료될 때 (Enter)까지 대기
  - 동시에 출력 버퍼를 통해 사용자에게 에코(화면 표시)를 수행
  - 버퍼는 FIFO(큐) 구조
  - 버퍼링이 꺼져 있는 경우를 로(raw) 모드, 켜져있는 경우를 쿡드(cooked) 모드라고 함


<img width="778" alt="image" src="https://github.com/user-attachments/assets/168860d8-b368-4807-8e7e-4672550a726c" />


#### 표준 I/O

- 사용자가 문자를 입력할 때마다 시스템 콜을 호출하는 문제를 막기 위해 표준 입출력(stdio) 라이브러리가 만들어짐
- stdio 라이브러리는 버퍼 입력을 지원하고, 시스템 콜을 한번만 사용해 장치 드라이버에서 읽은 데이터를 버퍼에 넣을 수 있음
- 출력하는 경우 버퍼가 꽉차거나 중요한 문자(새 줄 문자)가 출력 될 때까지 문자가 버퍼에 들어감
- 파일 특성을 기술하는 것보다 이름을 사용하면 편함
  - open 시스템 콜은 파일 이름을 파일을 참조할 수 있는 핸들이나 파일 디스크립터로 바꿔줌
  - 이 핸들은 close 시스템 콜로 닫을 수 있고, 닫히면 이 핸들을 더 이상 사용할 수 없음
  - stdio 라이브러리는 open, close, fopen, fclose 함수 제공
  - 사용자 프로그램이 문자를 기록하기 위해 매번 시스템 콜을 호줄하면 장치 드라이버에 줄력 버퍼가 아무 역할도 못한다.

<img width="643" alt="image" src="https://github.com/user-attachments/assets/491b11c9-ac3d-42f8-bb0b-44c821eb0264" />



#### 런타임 라이브러리와 표준 입출력

- C 프로그램 실행하려면 컴파일 후 컴파일된 코드와 stdio 라이브러리등 다른 코드를 링크해야 한다.
- C에서 런타임 라이브러리는 crt0 등의 이름으로 스택과 힙을 설정해서 사용할 수 있도록 준비하는 등의 설정을 담당한다.
- 런타임 라이브러리는 추가로 터미널 장치 드라이버와 연관된 파일을 하나는 입력을 위해, 다른 하나는 출력을 위해 연다.



<img width="413" alt="image" src="https://github.com/user-attachments/assets/e99b6286-5dca-4c7f-8ada-ce59b7c32f29" />

